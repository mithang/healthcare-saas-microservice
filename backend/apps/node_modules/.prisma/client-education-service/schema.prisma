datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
  output   = "../../node_modules/.prisma/client-education-service"
}

model Lecturer {
  id        String   @id @default(uuid())
  name      String
  title     String?
  specialty String?
  avatar    String?
  bio       String?
  courses   Course[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Course {
  id          String       @id @default(uuid())
  code        String       @unique
  name        String
  type        String // CME, CPE, etc.
  provider    String
  credits     Int
  price       Float        @default(0)
  status      String       @default("active") // active, upcoming, completed
  description String?
  thumbnail   String?
  lecturerId  String
  lecturer    Lecturer     @relation(fields: [lecturerId], references: [id])
  enrollments Enrollment[]
  quizzes     Quiz[]
  lessons     Lesson[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

model Lesson {
  id        String   @id @default(uuid())
  courseId  String
  course    Course   @relation(fields: [courseId], references: [id])
  title     String
  content   String?
  videoUrl  String?
  order     Int      @default(0)
  views     Int      @default(0)
  likes     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Enrollment {
  id          String    @id @default(uuid())
  userId      String
  courseId    String
  course      Course    @relation(fields: [courseId], references: [id])
  status      String    @default("enrolled") // enrolled, inprogress, completed, dropped
  progress    Float     @default(0)
  enrolledAt  DateTime  @default(now())
  completedAt DateTime?
  updatedAt   DateTime  @updatedAt

  @@unique([userId, courseId])
}

model Quiz {
  id        String     @id @default(uuid())
  courseId  String
  course    Course     @relation(fields: [courseId], references: [id])
  title     String
  questions Question[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}

model Question {
  id            String   @id @default(uuid())
  quizId        String
  quiz          Quiz     @relation(fields: [quizId], references: [id])
  content       String
  options       Json // Array of options
  correctOption Int // Index of the correct option
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}
